{% extends model('component') %}

{% define config = {
    name: 'comment-form',
    tag: 'comment-form',
} %}

{% define data = {
    method: 'POST',
    formView: 'add',
    comment: {},
    returnUrl: required,
    ownerId: '',
    ownerType: '',

    submit: {
        text: '',
        action: '',
    },

    remove: {
        text: '',
        action: '',
    },
} %}

{% set isAddFormView = data.formView == 'add' %}
{% set isUpdateFormView = data.formView == 'update' %}

{% block body %}
    {% set uuidField %}
        <input type="hidden" name="uuid" value="{{ data.comment ? data.comment.uuid }}">
    {% endset %}

    {% set messageField %}
        <textarea name="message" required="required" class="textarea textarea--expand spacing-bottom spacing-bottom-small">
            {%- if isUpdateFormView -%}
                {{ data.comment.message }}
            {%- endif -%}
        </textarea>
    {% endset %}

    {% set returnUrlField %}
        <input type="hidden" name="returnUrl" value="{{ data.returnUrl }}">
    {% endset %}

    {% block form %}
        <form class="{{ config.jsName }}__form" method="{{ data.method }}">
            {% if isAddFormView %}
                {{ messageField }}
                {{ returnUrlField }}
                <input type="hidden" name="ownerId" value="{{ data.ownerId }}">
                <input type="hidden" name="ownerType" value="{{ data.ownerType }}">
            {% endif %}
            {% if isUpdateFormView %}
                {{ messageField }}
                {{ uuidField }}
                {{ returnUrlField }}
            {% endif %}

            {% block tags %}
                {% if data.comment.tagNames is defined %}
                    <ul class="{{ config.name }}__tag-list">
                        {% for tagName in data.comment.tagNames %}
                            <li class="{{ config.name }}__tag-list-item">
                                <a class="{{ config.name }}__tag" href="{{ path('comment/tag/remove', {'uuid': data.comment.uuid, 'name': tagName, 'returnUrl': data.returnUrl }) }}">
                                    {{ tagName }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endblock %}

            {% block formHandlers %}
                <div class="{{ config.name }}__handlers">
                    <button action="{{ data.submit.action }}" class="button button--primary {{ config.jsName }}__submit-button">
                        {{ data.submit.text }}
                    </button>

                    {% if isUpdateFormView %}
                        <button action="{{ data.remove.action }}" class="button button--success {{ config.jsName }}__remove-button">
                            {{ data.remove.text }}
                        </button>
                    {% endif %}
                </div>
            {% endblock %}
        </form>
    {% endblock %}
{% endblock %}
